
  <h1>Reports in your area</h1>

  <div class="browse">
  <%= form_with url: reports_path, method: :get, local: true, class: "form-inline mt-3" do %>
      <%= text_field_tag :query, "", class: "form-control w-45", placeholder: "Address" %>
      <%= submit_tag "Search", class: "btn-home-secondary btn-secondary" %>
  <% end %>
  </div>


  <div class="container d-flex">
    <% if params[:query].present? %>
      <%= link_to params[:query], reports_path(request.params.except(:query)), class: "pill-category" %>
    <% end %>
    <% if params[:category_id].present? %>
      <%= link_to @reports.first.category.name, reports_path(request.params.except(:category_id)), class: "pill-category" %>
    <% end %>
    </div>

  <ul class="nav report-tab">
    <li><a class="active" data-toggle="tab" href="#list">List</a></li>
    <li><a data-toggle="tab" href="#map_container">Map</a></li>
  </ul>

  <div class="tab-content">

    <div id="list" class="tab-pane active">

      <div class="cards">

          <% @reports.sort_by { |r| r[:report_votes]}.reverse.each do |report|  %>
            <%= link_to report_path(report) do %>

              <div class="report-card">


               <% if report.photo.attached? %>
                <%= cl_image_tag report.photo.key  %>
               <% else %>
                <img src="https://www.rd.com/wp-content/uploads/2019/04/mai-khao-beach-phuket-thailand-june-222018-dirty-beach-along-the-shoreline.jpg">
               <% end %>


               <div class="report-card-info">

                 <div class="report-text">


                  <div>
                    <h2><%= report.title%></h2>
                    <p><i class="fas fa-map-marker-alt mr-2"></i><%= report.location.split(",").first%></p>
                    <%= link_to report.category.name, reports_path(request.params.merge(category_id: report.category.id)), class: "pill-category" %>
                   <!--  <a href="#" class="pill-category"><%= report.category.name %></a> -->
                  </div>


                </div>

              </div>

                <div class="upvotes-buttons mr-3">
                  <%= link_to upvote_report_path(report) do %>
                    <i class="fas fa-chevron-up"></i>
                  <% end %>
                  <span class="line-height"><%= report.total_votes %></span>
                  <%= link_to downvote_report_path(report) do %>
                    <i class="fas fa-chevron-down"></i>
                  <% end  %>
                </div>

              </div>
            <% end %>
          <% end %>
        </div>
      </div>



      <div id="map_container" class="tab-pane fade">
        <div id="map"
             style="width: 100%; height: 100vh;"
             data-markers="<%= @markers.to_json %>"
             data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>">
        </div>
      </div>
  </div>

</div>

